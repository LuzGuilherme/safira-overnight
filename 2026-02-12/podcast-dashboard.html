<!DOCTYPE html>
<html lang="pt" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üéß Podcast Digests ‚Äî Safira</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        safira: {
                            50: '#f0f9ff', 100: '#e0f2fe', 200: '#bae6fd', 300: '#7dd3fc',
                            400: '#38bdf8', 500: '#0ea5e9', 600: '#0284c7', 700: '#0369a1',
                            800: '#075985', 900: '#0c4a6e',
                        }
                    }
                }
            }
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .gradient-bg { background: linear-gradient(135deg, #0c4a6e 0%, #1e3a5f 50%, #0f172a 100%); }
        .card-hover { transition: all 0.3s ease; }
        .card-hover:hover { transform: translateY(-4px); box-shadow: 0 20px 40px -10px rgba(14, 165, 233, 0.2); }
        .modal-open { overflow: hidden; }
        .insight-border { border-left: 3px solid #0ea5e9; }
        .context-border { border-left: 3px solid #10b981; }
        .framework-border { border-left: 3px solid #8b5cf6; }
        .story-border { border-left: 3px solid #ec4899; }
        .quote-border { border-left: 3px solid #f59e0b; }
        .action-checkbox:checked + span { text-decoration: line-through; opacity: 0.5; }
        .fade-in { animation: fadeIn 0.3s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
        .markdown-content ul { list-style-type: disc; margin-left: 1.25rem; }
        .markdown-content li { margin-bottom: 0.25rem; }
        .markdown-content strong { color: #38bdf8; font-weight: 600; }
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #1e293b; }
        ::-webkit-scrollbar-thumb { background: #475569; border-radius: 4px; }
    </style>
</head>
<body class="bg-slate-900 text-slate-100 min-h-screen">
    <!-- Header -->
    <header class="gradient-bg border-b border-slate-700/50">
        <div class="max-w-6xl mx-auto px-4 py-6">
            <div class="flex items-center justify-between flex-wrap gap-4">
                <div class="flex items-center gap-3">
                    <span class="text-4xl">üéß</span>
                    <div>
                        <h1 class="text-2xl font-bold text-white">Podcast Digests</h1>
                        <p class="text-sm text-slate-400">Conhecimento condensado pela Safira ‚ú®</p>
                    </div>
                </div>
                <div class="flex items-center gap-4">
                    <input type="text" id="searchInput" placeholder="Pesquisar..." 
                           class="bg-slate-800/80 border border-slate-600 rounded-lg px-4 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-safira-500 w-48">
                    <span id="digestCount" class="text-sm text-slate-400 hidden md:block">0 digests</span>
                </div>
            </div>
        </div>
    </header>

    <main class="max-w-6xl mx-auto px-4 py-8">
        <!-- Tag Filters -->
        <div class="flex flex-wrap gap-2 mb-8" id="tagFilters"></div>
        
        <!-- Podcast Cards Grid -->
        <div id="digestGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div>
        
        <!-- Empty State -->
        <div id="emptyState" class="hidden text-center py-20">
            <span class="text-6xl mb-4 block">üéß</span>
            <h2 class="text-2xl font-bold text-slate-300 mb-2">Nenhum digest encontrado</h2>
        </div>
    </main>

    <!-- Detail Modal -->
    <div id="detailModal" class="fixed inset-0 bg-black/80 backdrop-blur-sm z-50 hidden overflow-y-auto">
        <div class="min-h-screen px-4 py-8">
            <div class="max-w-4xl mx-auto">
                <div class="bg-slate-800 rounded-2xl shadow-2xl fade-in" id="modalContent"></div>
            </div>
        </div>
    </div>

    <script>
        let digestsData = null;
        let activeTag = 'all';
        let searchQuery = '';

        async function loadData() {
            try {
                const response = await fetch('digests.json');
                digestsData = await response.json();
                init();
            } catch (e) {
                console.error('Failed to load digests.json', e);
            }
        }

        function init() {
            renderTagFilters();
            renderDigestGrid();
            document.getElementById('digestCount').textContent = `${digestsData.count} digest${digestsData.count !== 1 ? 's' : ''}`;
            document.getElementById('searchInput').addEventListener('input', e => {
                searchQuery = e.target.value.toLowerCase();
                renderDigestGrid();
            });
        }

        function renderTagFilters() {
            const container = document.getElementById('tagFilters');
            const allTags = new Set();
            digestsData.digests.forEach(d => d.tags?.forEach(t => allTags.add(t)));
            
            let html = `<button onclick="filterByTag('all')" class="px-3 py-1.5 rounded-full text-sm font-medium transition-colors ${activeTag === 'all' ? 'bg-safira-600 text-white' : 'bg-slate-700 text-slate-300 hover:bg-slate-600'}">Todos</button>`;
            [...allTags].slice(0, 8).forEach(tag => {
                html += `<button onclick="filterByTag('${tag}')" class="px-3 py-1.5 rounded-full text-sm font-medium transition-colors ${activeTag === tag ? 'bg-safira-600 text-white' : 'bg-slate-700 text-slate-300 hover:bg-slate-600'}">#${tag}</button>`;
            });
            container.innerHTML = html;
        }

        function filterByTag(tag) {
            activeTag = tag;
            renderTagFilters();
            renderDigestGrid();
        }

        function renderDigestGrid() {
            const container = document.getElementById('digestGrid');
            const filtered = digestsData.digests.filter(d => {
                const matchesTag = activeTag === 'all' || d.tags?.includes(activeTag);
                const matchesSearch = !searchQuery || 
                    d.title?.toLowerCase().includes(searchQuery) ||
                    d.guest?.toLowerCase().includes(searchQuery);
                return matchesTag && matchesSearch;
            });

            if (filtered.length === 0) {
                container.innerHTML = '';
                document.getElementById('emptyState').classList.remove('hidden');
                return;
            }
            document.getElementById('emptyState').classList.add('hidden');
            container.innerHTML = filtered.map(d => renderCard(d)).join('');
        }

        function renderCard(d) {
            const stars = '‚≠ê'.repeat(Math.round(d.rating || 0));
            const topInsights = (d.insights || []).slice(0, 3);
            
            return `
            <article class="bg-slate-800 rounded-xl overflow-hidden card-hover cursor-pointer" onclick="openModal('${d.id}')">
                <div class="p-5">
                    <!-- Header -->
                    <div class="flex justify-between items-start mb-3">
                        <h2 class="text-lg font-bold text-white leading-tight pr-2">${d.title}</h2>
                        <span class="text-sm flex-shrink-0">${stars}</span>
                    </div>
                    
                    <!-- Meta -->
                    <div class="text-xs text-slate-400 mb-3 space-y-1">
                        <div>üéôÔ∏è ${d.host}</div>
                        <div>üë§ ${d.guest?.split('‚Äî')[0] || d.guest}</div>
                        <div class="flex gap-3">
                            <span>‚è±Ô∏è ${d.duration}</span>
                            <span>üìÖ ${d.date}</span>
                        </div>
                    </div>
                    
                    <!-- TL;DR Preview -->
                    <p class="text-sm text-slate-300 mb-4 line-clamp-3">${d.tldr}</p>
                    
                    <!-- Top Insights Preview -->
                    ${topInsights.length > 0 ? `
                    <div class="mb-4">
                        <div class="text-xs font-semibold text-safira-400 mb-2">üí° Top Insights</div>
                        ${topInsights.map(ins => `
                            <div class="text-xs text-slate-400 mb-1 truncate">‚Ä¢ ${ins.insight}</div>
                        `).join('')}
                    </div>
                    ` : ''}
                    
                    <!-- Tags -->
                    <div class="flex flex-wrap gap-1 mb-4">
                        ${(d.tags || []).slice(0, 4).map(t => `<span class="px-2 py-0.5 bg-slate-700 rounded text-xs text-slate-400">#${t}</span>`).join('')}
                        ${(d.tags || []).length > 4 ? `<span class="text-xs text-slate-500">+${d.tags.length - 4}</span>` : ''}
                    </div>
                    
                    <!-- CTA -->
                    <button class="w-full py-2 bg-safira-600 hover:bg-safira-500 text-white text-sm font-medium rounded-lg transition-colors">
                        Ver Detalhes Completos ‚Üí
                    </button>
                </div>
            </article>`;
        }

        function openModal(id) {
            const d = digestsData.digests.find(x => x.id === id);
            if (!d) return;
            
            document.body.classList.add('modal-open');
            const modal = document.getElementById('detailModal');
            const content = document.getElementById('modalContent');
            
            content.innerHTML = renderModalContent(d);
            modal.classList.remove('hidden');
            
            modal.onclick = (e) => {
                if (e.target === modal) closeModal();
            };
        }

        function closeModal() {
            document.body.classList.remove('modal-open');
            document.getElementById('detailModal').classList.add('hidden');
        }

        function parseMarkdown(text) {
            if (!text) return '';
            return text
                .replace(/\*\*([^*]+)\*\*/g, '<strong>$1</strong>')
                .replace(/\n- /g, '<li>')
                .replace(/^- /, '<li>')
                .replace(/\n(\d+)\. /g, '<li>')
                .replace(/\n/g, '<br>');
        }

        function renderModalContent(d) {
            const stars = '‚≠ê'.repeat(Math.round(d.rating || 0));
            
            return `
            <!-- Modal Header -->
            <div class="gradient-bg p-6 rounded-t-2xl">
                <div class="flex justify-between items-start">
                    <div class="flex-1 pr-4">
                        <h2 class="text-2xl font-bold text-white mb-2">${d.title}</h2>
                        <div class="text-sm text-slate-300 space-y-1">
                            <div>üéôÔ∏è ${d.host}</div>
                            <div>üë§ ${d.guest}</div>
                            <div class="flex gap-4">
                                <span>‚è±Ô∏è ${d.duration}</span>
                                <span>üìÖ ${d.date}</span>
                            </div>
                        </div>
                    </div>
                    <div class="text-right">
                        <div class="text-xl mb-2">${stars}</div>
                        <a href="${d.link}" target="_blank" class="inline-block px-4 py-2 bg-red-600 hover:bg-red-500 text-white text-sm font-medium rounded-lg transition-colors">
                            ‚ñ∂ Ver Epis√≥dio
                        </a>
                    </div>
                </div>
                <button onclick="closeModal()" class="absolute top-4 right-4 text-slate-400 hover:text-white text-2xl">&times;</button>
            </div>
            
            <div class="p-6 space-y-6">
                <!-- TL;DR -->
                <section class="bg-slate-700/50 rounded-xl p-4">
                    <h3 class="text-sm font-bold text-safira-400 mb-2">üéØ TL;DR</h3>
                    <p class="text-slate-200">${d.tldr}</p>
                </section>
                
                <!-- Tags -->
                <div class="flex flex-wrap gap-2">
                    ${(d.tags || []).map(t => `<span class="px-3 py-1 bg-slate-700 rounded-full text-sm text-slate-300">#${t}</span>`).join('')}
                </div>
                
                ${renderSection('üìö', 'Resumo por Sec√ß√µes', d.sections_summary, 'sections')}
                ${renderInsightsSection(d.insights)}
                ${renderActionsSection(d.actions)}
                ${renderContextSection(d.context_application)}
                ${renderFrameworksSection(d.frameworks)}
                ${renderStoriesSection(d.stories)}
                ${renderResourcesSection(d.resources)}
                ${renderQuestionsSection(d.reflection_questions)}
                ${renderQuotesSection(d.quotes)}
                ${renderRatingBreakdown(d.rating_breakdown, d.verdict)}
            </div>
            
            <!-- Footer -->
            <div class="p-4 border-t border-slate-700 flex justify-between items-center">
                <a href="${d.link}" target="_blank" class="text-safira-400 hover:text-safira-300 text-sm">
                    ‚ñ∂ Ver epis√≥dio completo no YouTube
                </a>
                <button onclick="closeModal()" class="px-4 py-2 bg-slate-700 hover:bg-slate-600 text-white text-sm rounded-lg transition-colors">
                    Fechar
                </button>
            </div>`;
        }

        function renderSection(icon, title, data, type) {
            if (!data || Object.keys(data).length === 0) return '';
            
            let content = '';
            for (const [subtitle, text] of Object.entries(data)) {
                content += `
                <div class="mb-4 last:mb-0">
                    <h4 class="font-semibold text-safira-300 mb-2">${subtitle}</h4>
                    <div class="text-sm text-slate-300 markdown-content">${parseMarkdown(text)}</div>
                </div>`;
            }
            
            return `
            <section>
                <h3 class="text-lg font-bold text-white mb-4 flex items-center gap-2">${icon} ${title}</h3>
                <div class="bg-slate-700/30 rounded-xl p-4">${content}</div>
            </section>`;
        }

        function renderInsightsSection(insights) {
            if (!insights || insights.length === 0) return '';
            return `
            <section>
                <h3 class="text-lg font-bold text-white mb-4">üí° Top Insights (${insights.length})</h3>
                <div class="space-y-3">
                    ${insights.map((ins, i) => `
                    <div class="insight-border bg-slate-700/30 rounded-lg p-4">
                        <div class="font-semibold text-white">${i+1}. ${ins.insight}</div>
                        <div class="text-sm text-slate-400 mt-1">‚Ü≥ ${ins.why}</div>
                    </div>
                    `).join('')}
                </div>
            </section>`;
        }

        function renderActionsSection(actions) {
            if (!actions) return '';
            const hasActions = actions.immediate?.length || actions.week?.length || actions.longterm?.length;
            if (!hasActions) return '';
            
            return `
            <section>
                <h3 class="text-lg font-bold text-white mb-4">üõ†Ô∏è Ac√ß√µes Pr√°ticas</h3>
                <div class="grid md:grid-cols-3 gap-4">
                    ${actions.immediate?.length ? `
                    <div class="bg-green-900/20 border border-green-800/30 rounded-xl p-4">
                        <h4 class="font-semibold text-green-400 mb-3">‚ö° Fazer Hoje</h4>
                        ${actions.immediate.map((a, i) => `
                        <label class="flex items-start gap-2 mb-2 cursor-pointer text-sm">
                            <input type="checkbox" class="action-checkbox mt-0.5">
                            <span class="text-slate-300">${a}</span>
                        </label>
                        `).join('')}
                    </div>` : ''}
                    
                    ${actions.week?.length ? `
                    <div class="bg-yellow-900/20 border border-yellow-800/30 rounded-xl p-4">
                        <h4 class="font-semibold text-yellow-400 mb-3">üìÖ Esta Semana</h4>
                        ${actions.week.map((a, i) => `
                        <label class="flex items-start gap-2 mb-2 cursor-pointer text-sm">
                            <input type="checkbox" class="action-checkbox mt-0.5">
                            <span class="text-slate-300">${a}</span>
                        </label>
                        `).join('')}
                    </div>` : ''}
                    
                    ${actions.longterm?.length ? `
                    <div class="bg-blue-900/20 border border-blue-800/30 rounded-xl p-4">
                        <h4 class="font-semibold text-blue-400 mb-3">üéØ Longo Prazo</h4>
                        ${actions.longterm.map((a, i) => `
                        <label class="flex items-start gap-2 mb-2 cursor-pointer text-sm">
                            <input type="checkbox" class="action-checkbox mt-0.5">
                            <span class="text-slate-300">${a}</span>
                        </label>
                        `).join('')}
                    </div>` : ''}
                </div>
            </section>`;
        }

        function renderContextSection(context) {
            if (!context || Object.keys(context).length === 0) return '';
            return `
            <section>
                <h3 class="text-lg font-bold text-white mb-4">üéØ Aplica√ß√£o ao Teu Contexto</h3>
                <div class="grid md:grid-cols-2 gap-4">
                    ${Object.entries(context).map(([title, text]) => `
                    <div class="context-border bg-slate-700/30 rounded-lg p-4">
                        <h4 class="font-semibold text-emerald-400 mb-2">${title}</h4>
                        <div class="text-sm text-slate-300 markdown-content">${parseMarkdown(text)}</div>
                    </div>
                    `).join('')}
                </div>
            </section>`;
        }

        function renderFrameworksSection(frameworks) {
            if (!frameworks || frameworks.length === 0) return '';
            return `
            <section>
                <h3 class="text-lg font-bold text-white mb-4">üß† Frameworks & Modelos Mentais</h3>
                <div class="space-y-4">
                    ${frameworks.map(f => `
                    <div class="framework-border bg-slate-700/30 rounded-lg p-4">
                        <h4 class="font-semibold text-purple-400 mb-2">${f.name}</h4>
                        <div class="text-sm text-slate-300 markdown-content">${parseMarkdown(f.content)}</div>
                    </div>
                    `).join('')}
                </div>
            </section>`;
        }

        function renderStoriesSection(stories) {
            if (!stories || stories.length === 0) return '';
            return `
            <section>
                <h3 class="text-lg font-bold text-white mb-4">üìñ Hist√≥rias & Exemplos</h3>
                <div class="grid md:grid-cols-2 gap-4">
                    ${stories.map(s => `
                    <div class="story-border bg-slate-700/30 rounded-lg p-4">
                        <h4 class="font-semibold text-pink-400 mb-2">${s.title}</h4>
                        <div class="text-sm text-slate-300">${parseMarkdown(s.content)}</div>
                    </div>
                    `).join('')}
                </div>
            </section>`;
        }

        function renderResourcesSection(resources) {
            if (!resources || resources.length === 0) return '';
            return `
            <section>
                <h3 class="text-lg font-bold text-white mb-4">üîó Recursos Mencionados</h3>
                <div class="grid md:grid-cols-2 gap-3">
                    ${resources.map(r => `
                    <div class="bg-slate-700/30 rounded-lg p-3 text-sm">
                        <span class="text-safira-400 font-medium">${r.type}:</span>
                        <span class="text-slate-300 ml-1">${r.description}</span>
                    </div>
                    `).join('')}
                </div>
            </section>`;
        }

        function renderQuestionsSection(questions) {
            if (!questions || questions.length === 0) return '';
            return `
            <section>
                <h3 class="text-lg font-bold text-white mb-4">‚ùì Perguntas para Reflex√£o</h3>
                <div class="bg-slate-700/30 rounded-xl p-4 space-y-3">
                    ${questions.map((q, i) => `
                    <div class="flex items-start gap-3">
                        <span class="bg-safira-600 text-white text-xs font-bold rounded-full w-6 h-6 flex items-center justify-center flex-shrink-0">${i+1}</span>
                        <span class="text-slate-300">${q}</span>
                    </div>
                    `).join('')}
                </div>
            </section>`;
        }

        function renderQuotesSection(quotes) {
            if (!quotes || quotes.length === 0) return '';
            return `
            <section>
                <h3 class="text-lg font-bold text-white mb-4">üí¨ Quotes Memor√°veis</h3>
                <div class="space-y-3">
                    ${quotes.map(q => `
                    <div class="quote-border bg-slate-700/30 rounded-lg p-4">
                        <p class="text-slate-200 italic">"${q}"</p>
                    </div>
                    `).join('')}
                </div>
            </section>`;
        }

        function renderRatingBreakdown(breakdown, verdict) {
            if (!breakdown || Object.keys(breakdown).length === 0) return '';
            return `
            <section>
                <h3 class="text-lg font-bold text-white mb-4">üìä Rating Detalhado</h3>
                <div class="bg-slate-700/30 rounded-xl p-4">
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-4">
                        ${Object.entries(breakdown).map(([k, v]) => `
                        <div class="text-center">
                            <div class="text-lg">${'‚≠ê'.repeat(v)}</div>
                            <div class="text-xs text-slate-400">${k}</div>
                        </div>
                        `).join('')}
                    </div>
                    ${verdict ? `<p class="text-sm text-slate-300 italic border-t border-slate-600 pt-4">"${verdict}"</p>` : ''}
                </div>
            </section>`;
        }

        // Keyboard support
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') closeModal();
        });

        loadData();
    </script>
</body>
</html>
