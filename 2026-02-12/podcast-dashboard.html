<!DOCTYPE html>
<html lang="pt" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üéß Podcast Digests ‚Äî Safira</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        safira: {
                            50: '#f0f9ff',
                            100: '#e0f2fe',
                            200: '#bae6fd',
                            300: '#7dd3fc',
                            400: '#38bdf8',
                            500: '#0ea5e9',
                            600: '#0284c7',
                            700: '#0369a1',
                            800: '#075985',
                            900: '#0c4a6e',
                        }
                    }
                }
            }
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .gradient-bg { background: linear-gradient(135deg, #0c4a6e 0%, #1e3a5f 50%, #0f172a 100%); }
        .card-hover { transition: all 0.3s ease; }
        .card-hover:hover { transform: translateY(-2px); box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.3); }
        .insight-card { border-left: 3px solid #0ea5e9; }
        .quote-card { border-left: 3px solid #f59e0b; }
        .context-card { border-left: 3px solid #10b981; }
        .framework-card { border-left: 3px solid #8b5cf6; }
        .story-card { border-left: 3px solid #ec4899; }
        .action-checkbox:checked + span { text-decoration: line-through; opacity: 0.6; }
        .section-toggle { transition: transform 0.2s ease; }
        .section-toggle.open { transform: rotate(180deg); }
        .collapsible-content { max-height: 0; overflow: hidden; transition: max-height 0.3s ease-out; }
        .collapsible-content.open { max-height: 5000px; }
        .fade-in { animation: fadeIn 0.3s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #1e293b; }
        ::-webkit-scrollbar-thumb { background: #475569; border-radius: 4px; }
        .markdown-content ul { list-style-type: disc; margin-left: 1.5rem; }
        .markdown-content li { margin-bottom: 0.5rem; }
        .markdown-content strong { color: #38bdf8; }
    </style>
</head>
<body class="bg-slate-900 text-slate-100 min-h-screen">
    <!-- Header -->
    <header class="gradient-bg border-b border-slate-700/50 sticky top-0 z-50 backdrop-blur-sm">
        <div class="max-w-7xl mx-auto px-4 py-4">
            <div class="flex items-center justify-between flex-wrap gap-4">
                <div class="flex items-center gap-3">
                    <span class="text-3xl">üéß</span>
                    <div>
                        <h1 class="text-xl font-bold text-white">Podcast Digests</h1>
                        <p class="text-sm text-slate-400">Conhecimento condensado pela Safira ‚ú®</p>
                    </div>
                </div>
                <div class="flex items-center gap-4">
                    <input type="text" id="searchInput" placeholder="Pesquisar..." 
                           class="bg-slate-800/80 border border-slate-600 rounded-lg px-4 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-safira-500 w-48 md:w-64">
                    <span id="digestCount" class="text-sm text-slate-400">0 digests</span>
                </div>
            </div>
        </div>
    </header>

    <main class="max-w-7xl mx-auto px-4 py-8">
        <!-- Tag Filters -->
        <div class="flex flex-wrap gap-2 mb-8" id="tagFilters"></div>
        
        <!-- Digest List -->
        <div id="digestList" class="space-y-8"></div>
        
        <!-- Empty State -->
        <div id="emptyState" class="hidden text-center py-20">
            <span class="text-6xl mb-4 block">üéß</span>
            <h2 class="text-2xl font-bold text-slate-300 mb-2">Nenhum digest encontrado</h2>
        </div>
    </main>

    <script>
        // Load data from JSON file
        let digestsData = null;
        let activeTag = 'all';
        let searchQuery = '';

        async function loadData() {
            try {
                const response = await fetch('digests.json');
                digestsData = await response.json();
                init();
            } catch (e) {
                console.error('Failed to load digests.json', e);
            }
        }

        function init() {
            renderTagFilters();
            renderDigests();
            document.getElementById('digestCount').textContent = `${digestsData.count} digest${digestsData.count !== 1 ? 's' : ''}`;
            document.getElementById('searchInput').addEventListener('input', e => {
                searchQuery = e.target.value.toLowerCase();
                renderDigests();
            });
        }

        function renderTagFilters() {
            const container = document.getElementById('tagFilters');
            const allTags = new Set();
            digestsData.digests.forEach(d => d.tags?.forEach(t => allTags.add(t)));
            
            let html = `<button onclick="filterByTag('all')" class="tag-btn px-3 py-1.5 rounded-full text-sm font-medium ${activeTag === 'all' ? 'bg-safira-600 text-white' : 'bg-slate-700 text-slate-300 hover:bg-slate-600'}">Todos</button>`;
            allTags.forEach(tag => {
                html += `<button onclick="filterByTag('${tag}')" class="tag-btn px-3 py-1.5 rounded-full text-sm font-medium ${activeTag === tag ? 'bg-safira-600 text-white' : 'bg-slate-700 text-slate-300 hover:bg-slate-600'}">#${tag}</button>`;
            });
            container.innerHTML = html;
        }

        function filterByTag(tag) {
            activeTag = tag;
            renderTagFilters();
            renderDigests();
        }

        function parseMarkdown(text) {
            if (!text) return '';
            return text
                .replace(/\*\*([^*]+)\*\*/g, '<strong>$1</strong>')
                .replace(/\n- /g, '</li><li>')
                .replace(/^- /, '<li>')
                .replace(/\n(\d+)\. /g, '</li><li>')
                .replace(/\n/g, '<br>');
        }

        function renderDigests() {
            const container = document.getElementById('digestList');
            const filtered = digestsData.digests.filter(d => {
                const matchesTag = activeTag === 'all' || d.tags?.includes(activeTag);
                const matchesSearch = !searchQuery || 
                    d.title?.toLowerCase().includes(searchQuery) ||
                    d.guest?.toLowerCase().includes(searchQuery) ||
                    d.tldr?.toLowerCase().includes(searchQuery);
                return matchesTag && matchesSearch;
            });

            if (filtered.length === 0) {
                container.innerHTML = '';
                document.getElementById('emptyState').classList.remove('hidden');
                return;
            }
            document.getElementById('emptyState').classList.add('hidden');

            container.innerHTML = filtered.map(d => renderDigestCard(d)).join('');
        }

        function renderDigestCard(d) {
            const ratingStars = '‚≠ê'.repeat(Math.round(d.rating || 0));
            const sectionsHtml = renderSections(d);
            const insightsHtml = renderInsights(d);
            const actionsHtml = renderActions(d);
            const contextHtml = renderContext(d);
            const frameworksHtml = renderFrameworks(d);
            const storiesHtml = renderStories(d);
            const resourcesHtml = renderResources(d);
            const questionsHtml = renderQuestions(d);
            const quotesHtml = renderQuotes(d);

            return `
            <article class="bg-slate-800 rounded-2xl overflow-hidden card-hover fade-in">
                <!-- Header -->
                <div class="p-6 border-b border-slate-700">
                    <div class="flex justify-between items-start mb-4">
                        <div class="flex-1">
                            <h2 class="text-xl font-bold text-white mb-2">${d.title}</h2>
                            <div class="flex flex-wrap gap-4 text-sm text-slate-400">
                                <span>üéôÔ∏è ${d.host}</span>
                                <span>üë§ ${d.guest}</span>
                                <span>‚è±Ô∏è ${d.duration}</span>
                                <span>üìÖ ${d.date}</span>
                            </div>
                        </div>
                        <div class="text-right">
                            <div class="text-lg">${ratingStars}</div>
                            <a href="${d.link}" target="_blank" class="text-safira-400 hover:text-safira-300 text-sm">‚ñ∂ Ver Epis√≥dio</a>
                        </div>
                    </div>
                    
                    <!-- TL;DR -->
                    <div class="bg-slate-700/50 rounded-xl p-4">
                        <h3 class="text-sm font-semibold text-safira-400 mb-2">üéØ TL;DR</h3>
                        <p class="text-slate-200">${d.tldr}</p>
                    </div>

                    <!-- Tags -->
                    <div class="flex flex-wrap gap-2 mt-4">
                        ${(d.tags || []).map(t => `<span class="px-2 py-1 bg-slate-700 rounded-full text-xs text-slate-300">#${t}</span>`).join('')}
                    </div>
                </div>

                <!-- Collapsible Sections -->
                <div class="divide-y divide-slate-700">
                    ${sectionsHtml}
                    ${insightsHtml}
                    ${actionsHtml}
                    ${contextHtml}
                    ${frameworksHtml}
                    ${storiesHtml}
                    ${resourcesHtml}
                    ${questionsHtml}
                    ${quotesHtml}
                </div>

                <!-- Rating Breakdown -->
                ${d.rating_breakdown && Object.keys(d.rating_breakdown).length > 0 ? `
                <div class="p-6 bg-slate-850 border-t border-slate-700">
                    <h3 class="text-sm font-semibold text-slate-400 mb-3">üìä Rating Detalhado</h3>
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                        ${Object.entries(d.rating_breakdown).map(([k,v]) => `
                            <div class="text-center">
                                <div class="text-lg">${'‚≠ê'.repeat(v)}</div>
                                <div class="text-xs text-slate-500">${k}</div>
                            </div>
                        `).join('')}
                    </div>
                    ${d.verdict ? `<p class="mt-4 text-sm text-slate-300 italic">"${d.verdict}"</p>` : ''}
                </div>
                ` : ''}
            </article>`;
        }

        function renderCollapsibleSection(id, icon, title, content, defaultOpen = false) {
            if (!content) return '';
            return `
            <div class="section">
                <button onclick="toggleSection('${id}')" class="w-full p-4 flex items-center justify-between hover:bg-slate-700/30 transition-colors">
                    <span class="font-semibold text-slate-200">${icon} ${title}</span>
                    <svg id="toggle-${id}" class="w-5 h-5 text-slate-400 section-toggle ${defaultOpen ? 'open' : ''}" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                    </svg>
                </button>
                <div id="content-${id}" class="collapsible-content ${defaultOpen ? 'open' : ''} px-4 pb-4">
                    ${content}
                </div>
            </div>`;
        }

        function renderSections(d) {
            if (!d.sections_summary || Object.keys(d.sections_summary).length === 0) return '';
            const content = Object.entries(d.sections_summary).map(([title, text]) => `
                <div class="mb-4 last:mb-0">
                    <h4 class="font-medium text-safira-400 mb-2">${title}</h4>
                    <div class="text-sm text-slate-300 markdown-content">${parseMarkdown(text)}</div>
                </div>
            `).join('');
            return renderCollapsibleSection(`sections-${d.id}`, 'üìö', 'Resumo por Sec√ß√µes', content);
        }

        function renderInsights(d) {
            if (!d.insights || d.insights.length === 0) return '';
            const content = d.insights.map((ins, i) => `
                <div class="insight-card bg-slate-700/30 rounded-lg p-3 mb-2 last:mb-0">
                    <div class="font-medium text-white">${i+1}. ${ins.insight}</div>
                    <div class="text-sm text-slate-400 mt-1">‚Ü≥ ${ins.why}</div>
                </div>
            `).join('');
            return renderCollapsibleSection(`insights-${d.id}`, 'üí°', `Top Insights (${d.insights.length})`, content, true);
        }

        function renderActions(d) {
            if (!d.actions) return '';
            const sections = [];
            if (d.actions.immediate?.length) {
                sections.push(`<div class="mb-4"><h4 class="text-sm font-medium text-green-400 mb-2">‚ö° Fazer Hoje</h4>
                    ${d.actions.immediate.map((a,i) => `<label class="flex items-start gap-2 mb-2 cursor-pointer"><input type="checkbox" class="action-checkbox mt-1" id="imm-${d.id}-${i}"><span class="text-sm text-slate-300">${a}</span></label>`).join('')}</div>`);
            }
            if (d.actions.week?.length) {
                sections.push(`<div class="mb-4"><h4 class="text-sm font-medium text-yellow-400 mb-2">üìÖ Esta Semana</h4>
                    ${d.actions.week.map((a,i) => `<label class="flex items-start gap-2 mb-2 cursor-pointer"><input type="checkbox" class="action-checkbox mt-1" id="wk-${d.id}-${i}"><span class="text-sm text-slate-300">${a}</span></label>`).join('')}</div>`);
            }
            if (d.actions.longterm?.length) {
                sections.push(`<div><h4 class="text-sm font-medium text-blue-400 mb-2">üéØ Longo Prazo</h4>
                    ${d.actions.longterm.map((a,i) => `<label class="flex items-start gap-2 mb-2 cursor-pointer"><input type="checkbox" class="action-checkbox mt-1" id="lt-${d.id}-${i}"><span class="text-sm text-slate-300">${a}</span></label>`).join('')}</div>`);
            }
            if (sections.length === 0) return '';
            return renderCollapsibleSection(`actions-${d.id}`, 'üõ†Ô∏è', 'Ac√ß√µes Pr√°ticas', sections.join(''), true);
        }

        function renderContext(d) {
            if (!d.context_application || Object.keys(d.context_application).length === 0) return '';
            const content = Object.entries(d.context_application).map(([title, text]) => `
                <div class="context-card bg-slate-700/30 rounded-lg p-3 mb-3 last:mb-0">
                    <h4 class="font-medium text-emerald-400 mb-2">${title}</h4>
                    <div class="text-sm text-slate-300 markdown-content">${parseMarkdown(text)}</div>
                </div>
            `).join('');
            return renderCollapsibleSection(`context-${d.id}`, 'üéØ', 'Aplica√ß√£o ao Teu Contexto', content, true);
        }

        function renderFrameworks(d) {
            if (!d.frameworks || d.frameworks.length === 0) return '';
            const content = d.frameworks.map(f => `
                <div class="framework-card bg-slate-700/30 rounded-lg p-3 mb-3 last:mb-0">
                    <h4 class="font-medium text-purple-400 mb-2">${f.name}</h4>
                    <div class="text-sm text-slate-300 markdown-content">${parseMarkdown(f.content)}</div>
                </div>
            `).join('');
            return renderCollapsibleSection(`frameworks-${d.id}`, 'üß†', 'Frameworks & Modelos Mentais', content);
        }

        function renderStories(d) {
            if (!d.stories || d.stories.length === 0) return '';
            const content = d.stories.map(s => `
                <div class="story-card bg-slate-700/30 rounded-lg p-3 mb-3 last:mb-0">
                    <h4 class="font-medium text-pink-400 mb-2">${s.title}</h4>
                    <div class="text-sm text-slate-300">${parseMarkdown(s.content)}</div>
                </div>
            `).join('');
            return renderCollapsibleSection(`stories-${d.id}`, 'üìñ', 'Hist√≥rias & Exemplos', content);
        }

        function renderResources(d) {
            if (!d.resources || d.resources.length === 0) return '';
            const content = `<div class="grid grid-cols-1 md:grid-cols-2 gap-2">
                ${d.resources.map(r => `
                    <div class="bg-slate-700/30 rounded-lg p-3 text-sm">
                        <span class="text-safira-400 font-medium">${r.type}:</span>
                        <span class="text-slate-300 ml-1">${r.description}</span>
                    </div>
                `).join('')}
            </div>`;
            return renderCollapsibleSection(`resources-${d.id}`, 'üîó', 'Recursos Mencionados', content);
        }

        function renderQuestions(d) {
            if (!d.reflection_questions || d.reflection_questions.length === 0) return '';
            const content = d.reflection_questions.map((q, i) => `
                <div class="flex items-start gap-3 mb-3 last:mb-0">
                    <span class="bg-safira-600 text-white text-xs font-bold rounded-full w-6 h-6 flex items-center justify-center flex-shrink-0">${i+1}</span>
                    <span class="text-slate-300">${q}</span>
                </div>
            `).join('');
            return renderCollapsibleSection(`questions-${d.id}`, '‚ùì', 'Perguntas para Reflex√£o', content);
        }

        function renderQuotes(d) {
            if (!d.quotes || d.quotes.length === 0) return '';
            const content = d.quotes.map(q => `
                <div class="quote-card bg-slate-700/30 rounded-lg p-3 mb-2 last:mb-0">
                    <p class="text-slate-200 italic">"${q}"</p>
                </div>
            `).join('');
            return renderCollapsibleSection(`quotes-${d.id}`, 'üí¨', 'Quotes Memor√°veis', content);
        }

        function toggleSection(id) {
            const content = document.getElementById(`content-${id}`);
            const toggle = document.getElementById(`toggle-${id}`);
            content.classList.toggle('open');
            toggle.classList.toggle('open');
        }

        // Load on start
        loadData();
    </script>
</body>
</html>
